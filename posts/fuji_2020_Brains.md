---
title: '富士フィルムコンペ：第4回に参加してみて'
date: '2020-09-01'
tags: 'ml'
---

富士フイルムが主催しているデータ分析コンペ：[Brain(s)](http://fujifilmdatasciencechallnge.mystrikingly.com/)の参加記録です．
SMILES という低分子化合物の化学式から，溶解度や変異原性を予測するという**ケモインフォマティクス**分析がお題です．

まずこの**ケモノインフォマクティス**がわからんって感じで，情報系の学部にいると本当に理系らしさを失っていることに気付きました．
久々に溶解度なんて聞いたわって感じでした．

それでも世の中には Rdkit という便利なライブラリがあったりで参入障壁は低く，楽しくできました．

---

### 参加したきっかけ

普段は主にソフトウェア開発をしていますが，最近機械学習・深層学習の勉強をしたいと思い実践できるコンペを探して見つけたからです．  
元からこのコンペのことは知っていて，2,3 回目の時はどんなものかだけ見ていました（強強の人たちの進め方をみて学ぼうと思っていました笑）．  
それで，事前知識として様々なアルゴリズムの自主学習が終わったので実践したいと思い，今回参加してみました．

実は今回は入賞をしないで，上位入賞者の様々な解法を学んで，次あたりで本気で挑もうと思っていた(明らかにコンペ終盤に他の用事で作業ができないことがわかってた)のだが，中途半端に入賞してしまった・・・．

---

### コンペの概要

問題数は 3 問で以下の内容です．下記の Q2, Q3 のスコアを競いました．

- Q1:簡単な文字列の処理問題(文字列から C:炭素 の数を数える)
- Q2:テープルデータからの溶解度の予測(回帰)問題
- Q3:SMILES 記法からの毒性予測(２値分類)問題

submit 回数に制限がないので，やった分だけ成果が確認できます．
これがとてもコンペ初の人にはありがたかったです．
これも参入障壁が低いところですね．
モデルの容量が 10Mb という制限があるのでこちらは注意しなくてはいけない部分でした.

自分の最終スコアは以下でした．

- Q2: 0.83087(７位) [1 位の方は 0.84672]
- Q3: 0.64814(７位) [1 位の方は 0.68518]

<!--
![最終スコア](https://user-images.githubusercontent.com/38200453/108714627-1fbfbd80-755d-11eb-9177-bf5e2fedc5fd.png)
-->

![最終スコア](/md_images/fujifilm-4_score.png)

後に書きますが，この Q3 がとても難しい問題で，実課題に近い問題設定になっておりなかなか精度をあげることができませんでした．
実際にこれはやってもあげられんだろと思いほとんどこの問題には時間をかけてないです笑．

---

### Q2：溶解度の予測(回帰)問題

テーブルデータ(特徴量：約 200)から溶解度(Water Solubility)を予測します．  
たしかデータ数は 1000 強ほどでした．
こちらは富士フィルムさん側で用意されたデータセットでこれのみを使用し学習させます．
特徴量は，SMILES 化学式の文字列（）と Rdkit によて生成された特徴量です．
やったことは以下になります．

- 学習モデルの選択  
  学種モデルは，線形回帰，リッジ回帰，ラッソ回帰，ランダムフォレスト回帰，勾配ブースティング回帰(GBR)を試しました．
  最終的には勾配ブースティング回帰を選択しました．
  選択した理由としては，次で説明する特徴量の追加でほとんど追加をしなかったので，ランダムフォレストは限界値がすぐ見えてしまい途中からやることがなくなってしまった．
  そこで GBR を使用し，feature*importances*を確認し，必要なさそうなもを削除しながら(10〜50 ぐらいを削除)ハイパーパラメータを調整することにシフトしました．
  GridSearchCV でクロスバリデーションをしながらいい感じのモデルを作成しました．

- 特徴量の追加  
  Q1 で求めた C(炭素)の数を特徴量に追加．これしかしてません．もっとすればよかったと後悔しています．
  炭素の数やるなら他の元素の数とかだけでもやればよかったのですが，なぜかやらなかったです．
  1 位の人は特徴量エンジニアリングをしっかりしていて，ほとんどリッジ回帰のみのアンサンブルで戦っていてとても凄かったです．
  **特徴量エンジニアリングは大事**は大事と言うことがしっかりわかりました．あと筋トレも．

- その他  
  テーブルデータに向き合って，「この特徴量ない方が良さそう」などを考えて特徴量を減らしました．
  実際にそれでスコアが上がったりもしていて，ちょっと嬉しい気分になりました．  
  あとは，一般的に溶解度自体がどの特徴量に依存するかを勉強してみました．これは，自分に学がないからついでに勉強ってかんじですね．

---

### Q3：SMILES 記法からの毒性予測(２値分類)問題

SMILES 記法から，特徴量をそれぞれで作成して毒性の予測します．  
まずこの問題の最大の特徴は，**データはなんでも使っていいから，予測してみて**というものです．これはおっとおおっって思いました．
自分自身が初コンペということもあり，ちょっと疑問を持ったぐらいだったのですが，表彰式に参加してやはりかなり特殊だったのだとわかりました．
自分ごとなのですが．機械学習のコンペ，勉強の時に参考にしていた記事，本などだと，用意されているデータセット内で完結してしまう課題などが多い印象で，あまり実課題よりでないと思っていました．
ぶっちゃくこれで予測できて，本当の未知データに対してはどうなのと言うのが疑問にありました．
それが，今回の課題はかなり実課題よりで，**「機械学習を使用して，どのようなことがしたいか，役に立つのか」**が知れるいい問題設定だと思いました．

富士フィルムさん側からはデータの先の候補をあげて下さっていたので，今回はそちらを使用しました．
他にも様々なデータはん存在しているみたいだったので，もう少し探してみればよかったと思いました．
/
